apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-nginx-conf
data:
  mime.types: "types {\n  text/html html htm shtml;\n  text/css css;\n  text/xml xml rss;\n  image/gif gif;\n  image/jpeg jpeg jpg;\n  application/x-javascript js;\n  text/plain txt;\n  text/x-component htc;\n  text/mathml mml;\n  image/png png;\n  image/x-icon ico;\n  image/x-jng jng;\n  image/vnd.wap.wbmp wbmp;\n  application/java-archive jar war ear;\n  application/mac-binhex40 hqx;\n  application/pdf pdf;\n  application/x-cocoa cco;\n  application/x-java-archive-diff jardiff;\n  application/x-java-jnlp-file jnlp;\n  application/x-makeself run;\n  application/x-perl pl pm;\n  application/x-pilot prc pdb;\n  application/x-rar-compressed rar;\n  application/x-redhat-package-manager rpm;\n  application/x-sea sea;\n  application/x-shockwave-flash swf;\n  application/x-stuffit sit;\n  application/x-tcl tcl tk;\n  application/x-x509-ca-cert der pem crt;\n  application/x-xpinstall xpi;\n  application/zip zip;\n  application/octet-stream deb;\n  application/octet-stream bin exe dll;\n  application/octet-stream dmg;\n  application/octet-stream eot;\n  application/octet-stream iso img;\n  application/octet-stream msi msp msm;\n  audio/mpeg mp3;\n  audio/x-realaudio ra;\n  video/mpeg mpeg mpg;\n  video/quicktime mov;\n  video/x-flv flv;\n  video/x-msvideo avi;\n  video/x-ms-wmv wmv;\n  video/x-ms-asf asx asf;\n  video/x-mng mng;\n}\n"
  nginx.conf: "# https://mozilla.github.io/server-side-tls/ssl-config-generator/\n# https://www.ssllabs.com/ssltest/analyze.html?d=chat.sj.ifsc.edu.br\n# https://www.networking4all.com/en/support/\nevents {\n    worker_connections 1024;\n}\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    gzip on;\n    server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        return 301 https://$host$request_uri;\n    }\n    upstream netbox {\n        server netbox;\n    }\n    server {\n        listen 443 ssl http2;\n        listen [::]:443 ssl http2;\n        server_name netbox;\n        server_name netbox.sj.ifsc.edu.br;\n        ssl_certificate /etc/certs/cert.pem;\n        ssl_certificate_key /etc/certs/key.pem;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:50m;\n        ssl_session_tickets off;\n        ssl_protocols TLSv1.2;\n        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n        ssl_prefer_server_ciphers on;\n        add_header Strict-Transport-Security max-age=15768000;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        ssl_trusted_certificate /etc/certs/ca.pem;\n        location / {\n            proxy_http_version 1.1;\n            proxy_pass http://netbox/;\n            proxy_set_header Host $http_host;\n            add_header P3P 'CP=\"ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV\"';\n        }\n    }\n    upstream rocketchat {\n        server rocketchat:3000;\n    }\n    server {\n        listen 443 ssl http2;\n        listen [::]:443 ssl http2;\n        server_name chat;\n        server_name chat.sj.ifsc.edu.br;\n        ssl_certificate /etc/certs/cert.pem;\n        ssl_certificate_key /etc/certs/key.pem;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:50m;\n        ssl_session_tickets off;\n        ssl_protocols TLSv1.2;\n        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n        ssl_prefer_server_ciphers on;\n        add_header Strict-Transport-Security max-age=15768000;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        ssl_trusted_certificate /etc/certs/ca.pem;\n        location / {\n            proxy_http_version 1.1;\n            proxy_pass http://rocketchat/;\n            proxy_set_header Host $http_host;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"upgrade\";\n        }\n    }\n    upstream sharelatex {\n        server sharelatex;\n    }\n    server {\n        listen 443 ssl http2;\n        listen [::]:443 ssl http2;\n        server_name sharelatex;\n        server_name sharelatex.sj.ifsc.edu.br;\n        ssl_certificate /etc/certs/cert.pem;\n        ssl_certificate_key /etc/certs/key.pem;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:50m;\n        ssl_session_tickets off;\n        ssl_protocols TLSv1.2;\n        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n        ssl_prefer_server_ciphers on;\n        add_header Strict-Transport-Security max-age=15768000;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        ssl_trusted_certificate /etc/certs/ca.pem;\n        location / {\n            proxy_http_version 1.1;\n            proxy_pass http://sharelatex/;\n            proxy_set_header Host $http_host;\n        }\n    }\n    upstream mosquitto {\n        server mosquitto-ws:8083;\n    }\n    server {\n        listen 443 ssl http2;\n        listen [::]:443 ssl http2;\n        server_name mqtt;\n        server_name mqtt.sj.ifsc.edu.br;\n        ssl_certificate /etc/certs/cert.pem;\n        ssl_certificate_key /etc/certs/key.pem;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:50m;\n        ssl_session_tickets off;\n        ssl_protocols TLSv1.2;\n        ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n        ssl_prefer_server_ciphers on;\n        add_header Strict-Transp rt-Security max-age=15768000;\n        ssl_stapling on;\n        ssl_stapling_verify on;\n        ssl_trusted_certificate /etc/certs/ca.pem;\n        location / {\n            proxy_http_version 1.1;\n            proxy_pass https://mosquitto/;\n            proxy_set_header Host $http_host;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"upgrade\";\n       }\n    }\n}\n"
